description: NSD for IoT slice
metadata:
  ID: IoT_slice
  vendor: Mandat International / Device Gateway
  version: 1.3

topology_template:
  node_templates:
    UDGaaF:
        type: openbaton.type.VNF
        properties:
          vendor: Mandat International / Device Gateway
          version: 1.0
          endpoint: generic
          type: udg
          deploymentFlavour:
            - flavour_key: m1.medium
          configurations:
            name: defaultConfig
            configurationParameters: # be careful this may be overriden by ansible vars
              - server_name: UDG_server_name_85
              - ipv4_parent_address : 172.16.100.85 # udg.cityreport.org
              - ipv6_parent_address : fe80::f816:3eff:fe09:3b1f
              - client_id : UDG_client_id_85
              - client_name : UDG_client_name_85
              - cms_id : UDG_cmd_id_85

        requirements:
          - virtualLink: provider-network
          #- virtualLink: provider
          - vdu: VDU_UDG
        interfaces:
          lifecycle:
            INSTANTIATE:
              - test_echo.sh
              - configure.sh
              # - pre-install.sh
              # - install.sh
            #CONFIGURE:
              #- configure.sh
            # START:
            #   - start.sh

    VDU_UDG:
      type: tosca.nodes.nfv.VDU
      properties:
        scale_in_out: 1
        vim_instance_name:
          - mobile-openstack-aarhus # (!) dymanic - user input, it's the PoP name!
          #- dl380-openstack

      artifacts:
        VDU_UDGImage:
          type: tosca.artifacts.Deployment.Image.VM
          #file: Ubuntu-16.04 # for mobile-openstack-aarhus
          #file: Ubuntu_16.04 # for dl380-openstack
          file: udg_image_20190619 # test for faster deploy
          #file: UDGLightPreinstalled3

    CP_UDG:
      type: tosca.nodes.nfv.CP
      requirements:
        - virtualBinding: VDU_UDG
        - virtualLink: provider-network # for mobile-openstack-aarhus
        #- virtualLink: provider # for dl380-openstack

    provider: # for dl380-openstack
      type: tosca.nodes.nfv.VL
      properties:
        vendor: Mandat International / Device Gateway

    provider-network: # for mobile-openstack-aarhus
      type: tosca.nodes.nfv.VL
      properties:
        vendor: Mandat International / Device Gateway
